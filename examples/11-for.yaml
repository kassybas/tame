

settings:
  shieldEnv: true

globals:
  $tags:
  - latest
  - 2020.01
  - release
  $config:
    mac:
      os: darwin
      arch: amd64
    linux:
      os: linux
      arch: amd64


# tame -f examples/10-for.yaml Builder
targets:

  Foo:
    run:
    - for: {$: $name, in: ["john", "kate", "arthur"]}
      sh: echo Hello $name

  Builder:
    run:
    - for: {$: $platform, in: $config}
      call BuildBin: {$os: $config.$platform.os, $arch: $config.$platform.arch}
    - for: {$: $tag, in: $tags}
      call DockerTag: {$tag: $tag}

  DockerTag:
    args: {$tag}
    run:
    - sh: echo "docker tag myimage myimage:${tag}"

  BuildBin:
    args: {$os, $arch}
    run:
    - sh: echo building $os - $arch
