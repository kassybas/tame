
globals:
  $my_string: "hello world"
  $my_int: 42
  $user:
    name: John
    age: 22
    address:
      city: London
      street: Main street

targets:

  print-user:
    run:
    - sh: |
        echo "${user_name} is ${user_age} years old. Lives in ${user_address_city}"  # maps fields are separated by `_` in shell context which should configurable sooner or later
  
  build-all:
    run:
    - var $platforms:
        darwin:
          bin_path: "bin/bin_darwin"
          flags: "-cdsw"
        linux:
          bin_path: "bin/bin_linux"
          flags: "-cdsw"
    - call build: {$config: $platforms.darwin}   # maps fields are separated by `.` in tame context
    - call build: {$config: $platforms.linux}
    
  build:
    args: { $config }
    run:
    - sh: echo "I build to $config_bin_path with flags $config_flags"
